name: e2e Testing
on: [push, workflow_dispatch]
run-name: e2e Test by @${{ github.actor }}
jobs:
  drive:
    runs-on: windows-latest
    steps:
      - name: 📚 Git Checkout
        uses: actions/checkout@v3

      - name: 🐦 Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true

      - name: Install Chrome Browser
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable
        id: setup-chrome
        
      - name: Check Browser veersion
        run: |
          echo Installed chromium version: ${{ steps.setup-chrome.outputs.chrome-version }}
          C:\Progra~1\Google\Chrome\Application\chrome.exe --version

      - name: 🌐 Install Chromedriver
        uses: nanasess/setup-chromedriver@v2
        with:
          chromedriver-version: '113.0.5672.63'

      - name: ⏳ Delay
        run: |
          echo "Waiting for Chromedriver to start..."
          sleep 20

      - name: 🪛 Start Chromedriver
        run: |
          chromedriver --url-base=/wd/hub --port=4444 &

      - name: 📢 Check Chromedriver Version
        run: chromedriver -v

      - name: ⏳ Delay
        run: |
          echo "Waiting for Chromedriver to start..."
          sleep 15

      - name: Check Chromedriver Listening
        run: tasklist /FI "PID eq 4444"

      - name: 🚀 Run Integration Test
        run: |
          flutter config --enable-web
          flutter drive --driver=test_driver/integration_test.dart --target=e2e/home_scenario.dart -d web-server --profile --browser-name=chrome
